---
title: "Project 3"
author: "Yvette Callender"
date: '"` r "Sys.Date()`"'
output: 
    html_document:
        toc: TRUE
        toc_depth: 2
params: 
    EducationLevel: "Elementary"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The following libraries were used in this project.

```{r, message = FALSE}
library(tidyverse)
```

# Introduction

In this project, data related to diabetes health was analyzed using a variety of models.  

## Data 
A Diabetes Health Indicators Dataset: `diabetes_binary_health_indicators_BRFSS2015.csv` was used for this project.  This dataset can be found online [on Kaggle.](https://www.kaggle.com/code/jerryodegua/eda-prediction-of-diabetes-data) along with descriptions of the variabless.

## Variables
The dataset contains 21 variables than can potentially be used in the analysis.  A subset was chosen and they are described below.

The variable `diabetes_binary` is the response variable for this analysis. It is either a 0 (corresponding to a lack of either prediabetes or diabetes) or a 1 (corresponding to the presence of either prediabetes or diabetes).

The variable `HighBP` is a binary variable with 1 corresponding to high blood pressure and 0 corresponding to normal blood pressure.

The variable `HighChol` is a binary variable with 1 corresponding to high cholesterol levels and 0 corresponding to normal cholesterol levels.

The variable `BMI` (Body Mass Index) is a numeric variable.  As part of the analysis, it was converted to a categorical variable with values corresponding to underweight ($BMI \le 18.5$), normal ($18.5 \le BMI \le24.9$), overweight ($25.0 \le BMI \le29.9$) and obese ($30 \le BMI$).

The variable `HeartDiseaseorAttack` is a binary variable where 1 indicates a history of heart disease or attack and a 0 indicates a lack thereof.

The variable `GenHlth` is a categorical variable describing the the reported level of general health as described below:

|Level|Description|
|:---|:-----------:|
|1|excellent|
|2|very good|
|3|good|
|4|fair|
|5|poor|


The variable `DiffWalk` is binary with 1 corresponding to reported difficulty walking or climbing stairs and 0 corresponding to no reported 

The variable `Age` is a categorical variable with the following levels.  

|Level|Description|
|:---|:-----------:|
|1|18-24 years old|
|2|25-29 years old|
|3|30-34 years old|
|4|35-39 years old|
|5|40-44 years old|
|6|45-54 years old|
|7|50-54 years old|
|8|55-59 years old|
|9|60-64 years old|
|10|65-69 years old|
|11|70-74 years old|
|12|75-79 years old|
|13|$\ge$ 80 years old|


The variable `Education` is a categorical variable with the following levels. 

|Education Level|Description|
|:---|:-----------:|
|1|Never attended school or only kindergarten|
|2|Grades 1 through 8 (Elementary)|
|3|Grades 9-11 (Some high school)|
|4|Grade 12 or GED (High school graduate)|
|5|College 1 year to 3 years (Some college or technical school)|
|6|College 4 years or more (College graduate)|

For this analysis, data was divided into subsets based on the value of `Education`.  There are five subsets: one for levels one and two combined, and one each for levels three, four, five, and six.

## Purpose of EDA and Modeling and End Results

The relationship between the presence of diabetes/prediabetes (as indicated by `diabetes_binary`) and the predictor variables (`HighBP`, `HighChol`, `BMI` , `HeartDiseaseorAttack`, `GenHlth`, `DiffWalk`, and `Age`) were explored at several levels of education.  After Exploratory Data Analysis, the relationships were modeled using a variety or approaches (logistic regression, LASSO logistic regression, classification tree, random forest, *other 1, and other 2*) and a best model was chosen for each level of education. 

# Data Set-Up

Data was imported and converted to a tibble.  Columns corresponding to categorical variables were converted to factors.

```{r, cache=TRUE}

#Read in Data
diabetes_data <- read.csv ("diabetes_binary_health_indicators_BRFSS2015.csv") %>% 
                 as_tibble


#Select Desired Columns
diabetes_data <- diabetes_data %>%
    select(Diabetes_binary, HighBP, HighChol, BMI, HeartDiseaseorAttack, GenHlth,
           DiffWalk, Age, Education)

#For education make a new column where 1 and 2 are combined
diabetes_data$EducationDerived <- ifelse(diabetes_data$Education == 1 |
                                         diabetes_data$Education == 2 , '1_and_2',
                                         diabetes_data$Education)

#Convert EducationDerived to factor with labels
diabetes_data$EducationDerived <- factor(diabetes_data$EducationDerived, 
                                            levels = c('1_and_2', '3','4','5','6'), 
                                            labels = c("Elementary", "Some High School",
                                                       "High School Graduate", 
                                                       "Some College or Technical School",
                                                       "College Graduate"))

#Convert of binary variable to factors
diabetes_data <- diabetes_data %>% 
    mutate(Diabetes_binary = factor(Diabetes_binary, levels = c("0","1"), 
        labels = c("Non-diabetic", "Diabetic"))) %>%
    mutate(HighBP = factor(HighBP, levels = c("0","1"), 
        labels = c("Normal BP", "High BP"))) %>%
    mutate(HighChol = factor(HighChol, levels = c("0","1"), 
        labels = c("Normal Cholesterol", "High Cholesterol"))) %>%
    mutate(HeartDiseaseorAttack = factor(HeartDiseaseorAttack, levels = c("0","1"), 
        labels = c("No History", "History of Heart Disease or Attack"))) %>%
    mutate(DiffWalk = factor(DiffWalk, levels = c("0","1"), 
        labels = c("No Difficulty Walking or Climbing Stairs", 
                   "Difficulty Walking or Climbing Stairs"))) 

#Convert BMI to factors

diabetes_data <- diabetes_data %>% 
    mutate(BMIFactor = if_else (BMI <= 18.5, "Underweight",
                                if_else (BMI <= 24.9, "Healthy",
                                    if_else (BMI <= 29.9, "Overweight", "Obese"))))

#Convert age to factors 
diabetes_data <- diabetes_data %>% 
    mutate(Age = factor(Age, 
        levels =  c("1","2","3","4","5","6","7","8","9","10", "11", "12", "13"), 
                 labels = c("18-24", "25-29", "30-34", "35-39", "40-44", "45-49", "50-54",
                          "55-59", "60-64", "65-69", "70-74", "75-79", ">= 80" ))) 

# Convert GenHlth to factors

diabetes_data <- diabetes_data %>% 
    mutate(GenHlth = factor(GenHlth, 
        levels =  c("1","2","3","4","5"), 
                 labels = c("Excellent", "Very good", "Good", "Fair", "Poor")))
```

Data was filtered for the desired education level.

```{r}
diabetes_data_subset <- diabetes_data %>% 
    filter(EducationDerived == params$EducationLevel)
knitr::kable(head(diabetes_data_subset, n=10))
```


# Summarizations for Education = `r params$EducationLevel`

## Diabetes_binary

The  amounts of nondiabetics and diabetics in this dataset are:

```{r, Table-1}
#Make and print table
table1 <- table(diabetes_data_subset$Diabetes_binary)
knitr::kable(table1, col.names = c("Diabetes Status", "Frequency"))
```

`r paste0("There are ",  round(table1[1]/table1[2],1), "X as many nondiabetics as diabetics in the dataset at Education = ",  params$EducationLevel, ".")`

This can be seen graphically here.

```{r, Figure-1}
#Base layer
figure1 <- ggplot(diabetes_data_subset, aes(x = Diabetes_binary))
#Build up
figure1 + geom_bar() +
    labs( x = "Diabetes Status",
          y = "Count",
          title = "Diabetes Status Distibution")
```

## HighBP

The distribution in this dataset for high blood pressure is:

```{r, Table-2}
#Make and print table
table2 <- table(diabetes_data_subset$HighBP)
knitr::kable(table2, col.names = c("Blood Pressure", "Frequency"))
```

The distribution for diabetes status in this dataset as a function of blood pressure status is:
```{r, Table-3}
#Make and print table
table3 <- table(diabetes_data_subset$Diabetes_binary,diabetes_data_subset$HighBP)
knitr::kable(table3)
```

This can be seen graphically here.

```{r, Figure-2}
#Base layer
figure2 <- ggplot(diabetes_data_subset, aes(x = Diabetes_binary), )
#Build up
figure2 + geom_bar(aes(fill = HighBP)) +
    labs( x = "Diabetes Status",
          y = "Count",
          title = "Diabetes Status Distibution vs Blood Pressure Status")
```

## HighChol
The distribution in this dataset for high cholesterol is:

```{r, Table-4}
#Make and print table
table4 <- table(diabetes_data_subset$HighChol)
knitr::kable(table4, col.names = c("Cholesterol", "Frequency"))
```

The distribution for diabetes status in this dataset as a function of cholesterol status is:
```{r, Table-5}
#Make and print table
table5 <- table(diabetes_data_subset$Diabetes_binary,diabetes_data_subset$HighChol)
knitr::kable(table5)
```

This can be seen graphically here.

```{r, Figure-3}
#Base layer
figure3 <- ggplot(diabetes_data_subset, aes(x = Diabetes_binary), )
#Build up
figure3 + geom_bar(aes(fill = HighChol)) +
    labs( x = "Diabetes Status",
          y = "Count",
          title = "Diabetes Status Distibution vs Cholesterol Status")
```

## BMI
The distribution in this dataset for BMI as a numeric value is:

```{r, Table-6}
#Make and print table
table6 <- diabetes_data_subset %>% 
    summarize (Variable ="BMI",
               Minimum = min(BMI),
               Median= median(BMI),
               Maximum=max(BMI),
               Mean = round(mean (BMI),1),
               StdDev=round(sd(BMI),1)
              )
knitr::kable(table6)

```

``{r, Table-7}
#Make and print table
table7 <- table(diabetes_data_subset$BMIFactor)
knitr::kable(table7, col.names = c("BMI", "Frequency"))
```

The distribution for diabetes status in this dataset as a function of cholesterol status is:
``{r, Table-8}
#Make and print table
table8 <- table(diabetes_data_subset$Diabetes_binary,diabetes_data_subset$BMIFactor)
knitr::kable(table8)
```

This can be seen graphically here.

``{r, Figure-4}
#Base layer
figure4 <- ggplot(diabetes_data_subset, aes(x = Diabetes_binary), )
#Build up
figure4 + geom_bar(aes(fill = BMIFactor)) +
    labs( x = "Diabetes Status",
          y = "Count",
          title = "Diabetes Status Distibution vs BMI Classification")
```



## HeartDiseaseorAttack
## GenHlth
## DiffWalk
## Age

(group means sds, contingency tables six graphs)